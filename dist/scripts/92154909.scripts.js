!function(a){var b=function(b,c){var b=a(b),d=this,e='li:has([data-toggle="tab"])',f=a.extend({},a.fn.bootstrapWizard.defaults,c),g=null,h=null;this.rebindClick=function(a,b){a.unbind("click",b).bind("click",b)},this.fixNavigationButtons=function(){if(g.length||(h.find("a:first").tab("show"),g=h.find(e+":first")),a(f.previousSelector,b).toggleClass("disabled",d.firstIndex()>=d.currentIndex()),a(f.nextSelector,b).toggleClass("disabled",d.currentIndex()>=d.navigationLength()),d.rebindClick(a(f.nextSelector,b),d.next),d.rebindClick(a(f.previousSelector,b),d.previous),d.rebindClick(a(f.lastSelector,b),d.last),d.rebindClick(a(f.firstSelector,b),d.first),f.onTabShow&&"function"==typeof f.onTabShow&&f.onTabShow(g,h,d.currentIndex())===!1)return!1},this.next=function(a){return!b.hasClass("last")&&((!f.onNext||"function"!=typeof f.onNext||f.onNext(g,h,d.nextIndex())!==!1)&&($index=d.nextIndex(),void($index>d.navigationLength()||h.find(e+":eq("+$index+") a").tab("show"))))},this.previous=function(a){return!b.hasClass("first")&&((!f.onPrevious||"function"!=typeof f.onPrevious||f.onPrevious(g,h,d.previousIndex())!==!1)&&($index=d.previousIndex(),void($index<0||h.find(e+":eq("+$index+") a").tab("show"))))},this.first=function(a){return(!f.onFirst||"function"!=typeof f.onFirst||f.onFirst(g,h,d.firstIndex())!==!1)&&(!b.hasClass("disabled")&&void h.find(e+":eq(0) a").tab("show"))},this.last=function(a){return(!f.onLast||"function"!=typeof f.onLast||f.onLast(g,h,d.lastIndex())!==!1)&&(!b.hasClass("disabled")&&void h.find(e+":eq("+d.navigationLength()+") a").tab("show"))},this.currentIndex=function(){return h.find(e).index(g)},this.firstIndex=function(){return 0},this.lastIndex=function(){return d.navigationLength()},this.getIndex=function(a){return h.find(e).index(a)},this.nextIndex=function(){return h.find(e).index(g)+1},this.previousIndex=function(){return h.find(e).index(g)-1},this.navigationLength=function(){return h.find(e).length-1},this.activeTab=function(){return g},this.nextTab=function(){return h.find(e+":eq("+(d.currentIndex()+1)+")").length?h.find(e+":eq("+(d.currentIndex()+1)+")"):null},this.previousTab=function(){return d.currentIndex()<=0?null:h.find(e+":eq("+parseInt(d.currentIndex()-1)+")")},this.show=function(a){return b.find(e+":eq("+a+") a").tab("show")},this.disable=function(a){h.find(e+":eq("+a+")").addClass("disabled")},this.enable=function(a){h.find(e+":eq("+a+")").removeClass("disabled")},this.hide=function(a){h.find(e+":eq("+a+")").hide()},this.display=function(a){h.find(e+":eq("+a+")").show()},this.remove=function(b){var c=b[0],d="undefined"!=typeof b[1]&&b[1],f=h.find(e+":eq("+c+")");if(d){var g=f.find("a").attr("href");a(g).remove()}f.remove()},h=b.find("ul:first",b),g=h.find(e+".active",b),h.hasClass(f.tabClass)||h.addClass(f.tabClass),f.onInit&&"function"==typeof f.onInit&&f.onInit(g,h,0),f.onShow&&"function"==typeof f.onShow&&f.onShow(g,h,d.nextIndex()),d.fixNavigationButtons(),a('a[data-toggle="tab"]',h).on("click",function(b){var c=h.find(e).index(a(b.currentTarget).parent(e));if(f.onTabClick&&"function"==typeof f.onTabClick&&f.onTabClick(g,h,d.currentIndex(),c)===!1)return!1}),a('a[data-toggle="tab"]',h).on("shown shown.bs.tab",function(b){$element=a(b.target).parent();var c=h.find(e).index($element);return!$element.hasClass("disabled")&&((!f.onTabChange||"function"!=typeof f.onTabChange||f.onTabChange(g,h,d.currentIndex(),c)!==!1)&&(g=$element,void d.fixNavigationButtons()))})};a.fn.bootstrapWizard=function(c){if("string"==typeof c){var d=Array.prototype.slice.call(arguments,1);return 1===d.length&&d.toString(),this.data("bootstrapWizard")[c](d)}return this.each(function(d){var e=a(this);if(!e.data("bootstrapWizard")){var f=new b(e,c);e.data("bootstrapWizard",f)}})},a.fn.bootstrapWizard.defaults={tabClass:"nav nav-pills",nextSelector:".wizard li.next",previousSelector:".wizard li.previous",firstSelector:".wizard li.first",lastSelector:".wizard li.last",onShow:null,onInit:null,onNext:null,onPrevious:null,onLast:null,onFirst:null,onTabChange:null,onTabClick:null,onTabShow:null}}(jQuery);var rcSubmitDirective={rcSubmit:["$parse","$q","$timeout",function(a,b,c){return{restrict:"A",require:["rcSubmit","?form"],controller:["$scope",function(a){var b=null,c=null,d=[],e=[];this.attempted=!1,this.submitInProgress=!1,this.setFormElement=function(a){b=a},this.submit=function(){b&&jQuery(b).submit()},this.onAttempt=function(a){d.push(a)},this.setAttempted=function(){this.attempted=!0,angular.forEach(d,function(a){a()})},this.setFormController=function(a){c=a},this.needsAttention=function(a){return!!c&&(a?a.$invalid&&(a.$dirty||this.attempted):c&&c.$invalid&&(c.$dirty||this.attempted))},this.onSubmitComplete=function(a){e.push(a)},this.setSubmitComplete=function(a,b){angular.forEach(e,function(c){c({success:a,data:b})})}}],compile:function(d,e,f){return{pre:function(a,b,c,d){var e=d[0],f=d.length>1?d[1]:null;e.setFormElement(b),e.setFormController(f),a.rc=a.rc||{},a.rc[c.name]=e},post:function(d,e,f,g){var h=g[0],i=g.length>1?g[1]:null,j=a(f.rcSubmit);e.bind("submit",function(a){if(h.setAttempted(),d.$$phase||d.$apply(),!i.$valid)return!1;var e=function(){h.submitInProgress=!0,d.$$phase||d.$apply();var e=b.when(j(d,{$event:a}));e.then(function(a){h.submitInProgress=!1,d.$$phase||d.$apply(),c(function(){h.setSubmitComplete(!0,a)})},function(a){h.submitInProgress=!1,d.$$phase||d.$apply(),c(function(){h.setSubmitComplete(!1,a)})})};d.$$phase?(e(),d.$$phase||d.$apply()):d.$apply(e)})}}}}}]},rcFormModule=angular.module("rcForm",[]),rcSubmitDirective=rcSubmitDirective||null,rcVerifySetDirective=rcVerifySetDirective||null;rcSubmitDirective&&rcFormModule.directive(rcSubmitDirective),rcVerifySetDirective&&rcFormModule.directive(rcVerifySetDirective);var rcDisabledDirective={rcDisabled:["rcDisabled",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.rcDisabled,function(b){a.disable(c,b)})}}}]},rcDisabledProvider=function(){var a,b=function(a,b){var c=jQuery(a);return c.find(":not([rc-disabled])").filter(function(a){return 0===jQuery(this).parents().not(c).filter("[rc-disabled]").length}).filter("input:not([ng-disabled]), button:not([ng-disabled])").prop("disabled",b)};this.onDisable=function(b){a=b},this.$get=function(){return{disable:function(c,d){return a?a(c,d):b(c,d)}}}};angular.module("rcDisabled",[]).provider("rcDisabled",rcDisabledProvider).directive(rcDisabledDirective),angular.module("rcDisabledBootstrap",["rcDisabled"]).provider("rcDisabled",rcDisabledProvider).directive(rcDisabledDirective).config(["rcDisabledProvider",function(a){a.onDisable(function(a,b){var c=jQuery(a);c=c.find(":not([rc-disabled])").filter(function(a){return 0===jQuery(this).parents().not(c).filter("[rc-disabled]").length}).filter("input:not([ng-disabled]), button:not([ng-disabled]), .btn, li").add(c),c.button&&c.find("[data-loading-text]").button(b?"loading":"reset"),c.toggleClass("disabled",b).filter("input, button").prop("disabled",b)})}]);var rcWizardDirective={rcWizard:function(){return{restrict:"A",controller:["$scope",function(a){var b,c,d={},e=[];this.currentIndex=0,this.firstIndex=0,this.navigationLength=0,this.addStep=function(a){e.push(a),a.element&&a.submitController&&(jQuery(a.element).append('<input type="submit" tabindex="-1" style="position: absolute; left: -9999px; width: 1px; height: 1px;" />').attr("action","javascript:void(0);"),a.submitController.onSubmitComplete(function(b){b.success&&f(a)}))},this.forward=function(){if(e.length)var a=e.length>b.currentIndex?e[b.currentIndex]:null;0<e.length&&!a||(0<e.length&&a.submitController?a.submitController.submit():f(a))};var f=function(a){0<e.length&&a.formController&&a.formController.$invalid||c.bootstrapWizard("next")};this.backward=function(){c.bootstrapWizard("previous")};var g=function(d,e,f,g){b.currentIndex=g,b.firstIndex=c.bootstrapWizard("firstIndex"),b.navigationLength=c.bootstrapWizard("navigationLength"),a.$$phase||a.$apply()},h=function(a,b,c,d){return!1},i=function(a,b,d){d>0?(c.find(".nav li:gt("+(d-1)+")").removeClass("success"),c.find(".nav li:lt("+d+")").addClass("success")):c.find(".nav li").removeClass("success"),e.length>d&&e[d].element&&e[d].element.find("input").first().focus()},j=function(e){d=e,c&&(c.bootstrapWizard(e),b.currentIndex=c.bootstrapWizard("currentIndex"),b.firstIndex=c.bootstrapWizard("firstIndex"),b.navigationLength=c.bootstrapWizard("navigationLength"),a.$$phase||a.$apply())};this.setWizardElement=function(a){c=a,b=this,j({onTabChange:g,onTabShow:i,onTabClick:h})}}],compile:function(a,b,c){return{pre:function(a,b,c,d){a.rc=a.rc||{},a.rc[c.rcWizard]=d},post:function(a,b,c,d){d.setWizardElement(b),a.$$phase||a.$apply()}}}}}},rcWizardStepDirective={rcStep:function(){return{restrict:"A",require:["^rcWizard","?form","?rcSubmit"],link:function(a,b,c,d){var e=d[0],f=d.length>1?d[1]:null,g=d.length>2?d[2]:null;e.addStep({element:b,attributes:c,formController:f,submitController:g})}}}};angular.module("rcWizard",["ng"]).directive(rcWizardDirective).directive(rcWizardStepDirective),function(){function a(a,b){var c=this;c.isLoggedIn=b.isLoggedIn(),c.currentUser=b.currentUser()}angular.module("openSenseMapApp").controller("navigationCtrl",a),a.$inject=["$location","authentication"]}(),function(){function a(){return{restrict:"EA",templateUrl:"views/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("openSenseMapApp").directive("navigation",a)}(),angular.module("openSenseMapApp",["ngResource","ngSanitize","ngRoute","ngDialog","ui-leaflet","ui.bootstrap","ui.checkbox","ui.bootstrap.datetimepicker","osemFilters","angular-underscore","rcWizard","rcForm","flow","pascalprecht.translate","ui.router","gridshore.c3js.chart","angularMoment","tmh.dynamicLocale"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$compileProvider","$logProvider","tmhDynamicLocaleProvider",function(a,b,c,d,e,f){d.debugInfoEnabled(!1),e.debugEnabled(!1),c.html5Mode(!0),b.otherwise("/"),f.localeLocationPattern("translations/angular/angular-locale_{{locale}}.js"),a.state("explore",{url:"/","abstract":!0,templateUrl:"views/explore2.html"}).state("explore.map",{url:"",controller:"MapCtrl",templateUrl:"views/explore2.map.html"}).state("explore.map.boxdetails",{url:"explore/:id",views:{sidebar:{controller:"SidebarBoxDetailsCtrl",templateUrl:"views/explore2.sidebar.box.html"}}}).state("explore.map.filter",{url:"filter",views:{sidebar:{controller:"SidebarFilterCtrl",templateUrl:"views/explore2.sidebar.filter.html"}}}).state("explore.map.download",{url:"download",views:{sidebar:{controller:"SidebarDownloadCtrl",templateUrl:"views/explore2.sidebar.download.html"}}}).state("explore.map.interpolation",{url:"interpolation",views:{sidebar:{controller:"InterpolationCtrl",templateUrl:"views/explore2.sidebar.interpolation.html"}}}).state("explore.map.login",{url:"login",views:{sidebar:{controller:"loginCtrl",templateUrl:"views/explore2.sidebar.login.html",controllerAs:"vm"}}}).state("explore.map.loginsuccess",{url:"loginsuccess",views:{sidebar:{controller:"loginsuccessCtrl",templateUrl:"views/explore2.sidebar.loginsuccess.html",controllerAs:"vm"}}}).state("explore.map.logout",{url:"logout",views:{sidebar:{controller:"logoutCtrl",templateUrl:"views/explore2.sidebar.logout.html",controllerAs:"vm"}}}).state("profile",{url:"/profile",templateUrl:"views/profile.html",controller:"profileCtrl",controllerAs:"vm"}).state("game",{url:"/game",templateUrl:"views/game.html",controller:"gameCtrl",controllerAs:"vm"}).state("leaderboard",{url:"/leaderboard",templateUrl:"views/leaderboard.html",controller:"leaderboardCtrl",controllerAs:"vm"}).state("account",{url:"/account",templateUrl:"views/account.html",controller:"accountCtrl",controllerAs:"vm"}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"RegisterCtrl"}).state("userregister",{url:"/userregister",templateUrl:"views/userregister.html",controller:"userregisterCtrl",controllerAs:"vm"}).state("info",{url:"/info",templateUrl:"views/info.html"})}]).config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"../translations/",suffix:".json"}),a.use("de_DE"),a.fallbackLanguage("en_US"),a.preferredLanguage("de_DE"),a.determinePreferredLanguage(),a.useSanitizeValueStrategy("escaped")}]).filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).factory("FilterActiveService",function(){return{active:!1}}),angular.module("openSenseMapApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),function(){"use strict";function a(a,b){var c=this;c.credentials={firstname:"",lastname:"",email:"",username:"",password:"",password2:""},c.onSubmit=function(){c.credentials.password!==c.credentials.password2?alert("Passwörter stimmen nicht überein! bitte erneut eingeben"):(console.log("Submitting registration"),b.register(c.credentials).error(function(a){alert(a)}).then(function(){a.path("/loginsuccess"),document.getElementById("navlogin").style.display="none",document.getElementById("profile").style.display="block"}))}}angular.module("openSenseMapApp").controller("userregisterCtrl",a),a.$inject=["$location","authentication"]}(),angular.module("openSenseMapApp").controller("RegisterCtrl",["$scope","$state","$http","$q","$timeout","$filter","$location","leafletData","OpenSenseBoxAPI","SensorIcons","$translate",function(a,b,c,d,e,f,g,h,i,j,k){a.osemapi=i,a.icons=j,a.alerts=[],a.editing={},a.isCustom={},a.sensorSetup="",a.models={home:!1,basic:!1,custom:!1,wifi:!1,ethernet:!1},a.modelSelected={id:!1,name:!1},a.markers={},a.user={firstname:"",lastname:"",email:"",lang:"de_DE"},a.newSenseBox={id:"",name:"",model:"",boxType:"fixed",sensors:[],tag:"",exposure:"",orderID:"",loc:[{type:"feature",geometry:{type:"Point",coordinates:[]}}]},a.mqtt={enabled:!1,url:"",topic:"",messageFormat:"",decodeOptions:"",connectionOptions:""},a.editMarkerInput=angular.copy(a.markers),a.$watchCollection("editMarkerInput.box",function(b){b&&b.lat&&b.lng&&(void 0===a.markers.box&&(a.markers.box={}),a.markers.box.lng=b.lng,a.markers.box.lat=b.lat)}),a.invalidHardware=!1,a.enterEvent=function(b){13===b.which&&(0===a.rc.sampleWizard.currentIndex?a.rc.sampleWizard.forward():1===a.rc.sampleWizard.currentIndex?(this.generateID(),this.goToMap()):2===a.rc.sampleWizard.currentIndex?(a.modelSelected.id===!1?a.invalidHardware=!0:a.invalidHardware=!1,0===a.sensors.length?a.sensorIncomplete=!0:a.sensorIncomplete=!1):3===a.rc.sampleWizard.currentIndex&&a.completeRegistration())},a.submit=function(){1===a.rc.sampleWizard.currentIndex?(this.generateID(),this.goToMap()):2===a.rc.sampleWizard.currentIndex&&(a.modelSelected.id===!1?a.invalidHardware=!0:a.invalidHardware=!1,0===a.sensors.length?a.sensorIncomplete=!0:a.sensorIncomplete=!1),a.rc.sampleWizard.forward()},a.goToMap=function(){e(function(){h.getMap().then(function(b){a.$watch("$viewContentLoaded",function(){b.invalidateSize()})})},100)},a.$watch("modelSelected.id",function(b){switch(console.log("Selected "+b),b){case"homeEthernet":a.modelSelected.name="senseBox Home Ethernet",a.models={home:!0,basic:!1,custom:!1,wifi:!1,ethernet:!0},a.sensors=[],a.sensorSetup=a.modelSelected.id;break;case"homeWifi":a.modelSelected.name="senseBox Home Wifi",a.models={home:!0,basic:!1,custom:!1,wifi:!0,ethernet:!1},a.sensors=[],a.sensorSetup=a.modelSelected.id;break;case"basicEthernet":a.modelSelected.name="senseBox Basic Ethernet",a.models={home:!1,basic:!0,custom:!1,wifi:!1,ethernet:!0},a.sensors=[],a.sensorSetup=a.modelSelected.id;break;case"basicWifi":a.modelSelected.name="senseBox Basic Wifi",a.models={home:!1,basic:!0,custom:!1,wifi:!0,ethernet:!1},a.sensors=[],a.sensorSetup=a.modelSelected.id;break;case"custom":a.modelSelected.name="senseBox manuelle Konfiguration",a.models={home:!1,basic:!1,custom:!0,wifi:!1,ethernet:!1},a.sensorSetup="";break;default:a.modelSelected.name=!1}a.invalidHardware=!1}),a.defaults={minZoom:2,maxZoom:22,tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{subdomains:"abc",attribution:'&copy; <a href="http://osm.org/copyright" target="_blank">OpenStreetMap</a> contributors | Tiles &copy; <a href="http://www.mapbox.com/" target="_blank">Mapbox</a>',detectRetina:!0,reuseTiles:!0,maxZoom:22},worldCopyJump:!0,scrollWheelZoom:!0,center:{lat:51.04139389812637,lng:10.21728515625,zoom:5}},angular.extend(a,{center:{autoDiscover:!0},events:{map:{enable:["click","locationfound","locationerror"],logic:"emit"}}}),a.edit=function(b){a.editing[b]=!0},a.remove=function(b){a.sensors.splice(b,1),a.isCustom[b]=!1,a.editing[b]=!1;for(var c=0;c<a.sensors.length;c++)a.sensors[c].id=c;0===a.sensors.length?(a.sensorSetup="",a.sensorIncomplete=!0):a.sensorSetup=JSON.stringify(a.sensors)},a.makeCustom=function(b,c){return"Anderer"===b&&void(a.isCustom[c]=!0)},a.add=function(){var b={id:a.sensors.length,icon:"",title:"",unit:"",sensorType:""};a.sensors.push(b),a.sensorSetup=JSON.stringify(a.sensors),this.edit(b.id),a.sensorIncomplete=!1},a.setSensorIcon=function(a,b){a.icon=b.name},a.fixedBox=!0,a.change=function(){a.fixedBox=!a.fixedBox},a.sensors=[],a.generateID=function(){var b=((new Date).getTime()/1e3|0).toString(16),c=b+"xxxxxxxxxxxxxxxx".replace(/[x]/g,function(){return(16*Math.random()|0).toString(16)}).toLowerCase();a.newSenseBox.orderID=c},a.fallback=function(a){window.prompt("Press cmd+c to copy the text below.",a)},a.showMap=!1,a.$watch("showMap",function(a){a===!0&&h.getMap("map_register").then(function(a){a.invalidateSize()})}),a.open={collapse1:!0,collapse2:!1,collapse3:!1},a.$watchCollection("open.collapse2",function(b){b&&(a.modelSelected.id="custom")}),a.goToMap=function(){e(function(){h.getMap("map_register").then(function(b){a.$watch("$viewContentLoaded",function(){b.invalidateSize()})})},100)},a.$on("leafletDirectiveMarker.map_register.dragend",function(b,c){a.markers[c.modelName].lat=parseFloat(c.model.lat.toFixed(6)),a.markers[c.modelName].lng=parseFloat(c.model.lng.toFixed(6)),a.editMarkerInput=angular.copy(a.markers)}),a.$on("leafletDirectiveMap.map_register.click",function(b,c){0===Object.keys(a.markers).length?a.markers.box={lat:parseFloat(c.leafletEvent.latlng.lat.toFixed(6)),lng:parseFloat(c.leafletEvent.latlng.lng.toFixed(6)),draggable:!0}:(a.markers.box.lat=parseFloat(c.leafletEvent.latlng.lat.toFixed(6)),a.markers.box.lng=parseFloat(c.leafletEvent.latlng.lng.toFixed(6)),a.markers.box.draggable=!0),a.editMarkerInput=angular.copy(a.markers)}),a.$on("leafletDirectiveMap.map_register.locationfound",function(b,c){0===Object.keys(a.markers).length?a.markers.box={lat:parseFloat(c.leafletEvent.latlng.lat.toFixed(6)),lng:parseFloat(c.leafletEvent.latlng.lng.toFixed(6)),draggable:!0}:(a.markers.box.lat=parseFloat(c.leafletEvent.latlng.lat.toFixed(6)),a.markers.box.lng=parseFloat(c.leafletEvent.latlng.lng.toFixed(6)),a.markers.box.draggable=!0),h.getMap("map_register").then(function(a){a.setView([c.leafletEvent.latlng.lat,c.leafletEvent.latlng.lng],16)}),a.editMarkerInput=angular.copy(a.markers)}),a.$on("leafletDirectiveMap.map_register.locationerror",function(a){console.log(a)}),a.goToBox=function(){b.go("explore.map.boxdetails",{id:a.newSenseBox.id})};var l=function(){var b=a.newSenseBox.id,d=a.newSenseBox.apikey;c.get(a.osemapi.url+"/boxes/"+b+"/script",{headers:{"X-ApiKey":d}}).success(function(b){a.boxScript=b}).error(function(){})},m=function(){var b=a.newSenseBox.id;c.get(a.osemapi.url+"/boxes/"+b,{}).success(function(b){a.registeredSensors=b.sensors}).error(function(){})};a.completeRegistration=function(){if(a.alerts=[],a.newSenseBox.apikey=a.newSenseBox.orderID,a.newSenseBox.user=a.user,a.newSenseBox.mqtt=a.mqtt,a.newSenseBox.loc[0].geometry.coordinates.push(a.markers.box.lng),a.newSenseBox.loc[0].geometry.coordinates.push(a.markers.box.lat),void 0!==k.proposedLanguage()&&(a.newSenseBox.user.lang=k.proposedLanguage()),"custom"===a.modelSelected.id)for(var b=0;b<a.sensors.length;b++)a.newSenseBox.sensors=a.sensors;else a.newSenseBox.model=a.modelSelected.id;c.post(a.osemapi.url+"/boxes",a.newSenseBox).success(function(b){a.newSenseBox.id=b.boxes[0],a.rc.sampleWizard.forward(),k("REGISTRATION_SUCCESS").then(function(b){var c={type:"success",msg:b};a.alerts.push(c),a.regSuccess=!0}),l(),m()}).error(function(){k("REGISTRATION_FAIL").then(function(b){var c={type:"danger",msg:b};a.alerts.push(c)})})}}]),angular.module("openSenseMapApp").controller("MapCtrl",["$scope","$state","OpenSenseBoxes","leafletData","$templateRequest","$compile","OpenSenseMapData",function(a,b,c,d,e,f,g){a.showAllMarkers=!0,a.inputFilter=a.inputFilter||{loading:!1,needsRefresh:!1},a.defaults={minZoom:2,maxZoom:22,tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{subdomains:"abc",detectRetina:!0,reuseTiles:!0,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors | Tiles &copy; <a href="http://www.mapbox.com/" target="_blank">Mapbox</a>',maxZoom:22},scrollWheelZoom:!0,worldCopyJump:!0},a.events={map:{enable:["click","load","zoomstart"],logic:"broadcast"}};var h={iconRed:{type:"awesomeMarker",prefix:"fa",icon:"cube",markerColor:"red"},iconGreen:{type:"awesomeMarker",prefix:"fa",icon:"cube",markerColor:"green"},iconDarkGreen:{type:"awesomeMarker",prefix:"fa",icon:"cube",markerColor:"darkgreen"},iconGray:{type:"awesomeMarker",prefix:"fa",icon:"cube",markerColor:"lightgray"}};angular.extend(a,{center:{lat:51.04139389812637,lng:10.21728515625,zoom:6},layers:{baselayers:{mapbox:{name:"Mapbox Streets",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],detectRetina:!0,reuseTiles:!0,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors | Tiles &copy; <a href="http://www.mapbox.com/" target="_blank">Mapbox</a>',showOnSelector:!1,maxZoom:22}}},overlays:{activeMarker:{type:"group",name:"activeMarker",visible:!0},inactiveMarker:{type:"group",name:"inactiveMarker",visible:!0},oldMarker:{type:"group",name:"oldMarker",visible:!0},hiddenMarker:{type:"group",name:"hiddenMarker",visible:!1}}},markers:{},filtered:{},controls:{custom:[]},toggleLayer:function(b){a.layers.overlays[b].visible=!a.layers.overlays[b].visible},watchOptions:{markers:{type:null,individual:{type:null}}}});var i={hidden:{layer:"hiddenMarker",marker:h.iconGray,opacity:0,zIndexOffset:300},old:{layer:"oldMarker",marker:h.iconGray,opacity:.5,zIndexOffset:0},inactive:{layer:"inactiveMarker",marker:h.iconDarkGreen,opacity:.65,zIndexOffset:100},active:{layer:"activeMarker",marker:h.iconGreen,opacity:1,zIndexOffset:200}},j=864e5,k=7*j,l=30*j,m=function(a){var b=Date.now(),c=a.sensors.reduceRight(function(a,c,d){if(c.lastMeasurement&&c.lastMeasurement.createdAt){var e=Date.parse(c.lastMeasurement.createdAt);"old"===a&&b-e<l&&(a="inactive"),"inactive"===a&&b-e<k&&(a="active")}return 0===d?i[a]:a},"old"),d={layer:c.layer,icon:c.marker,lng:a.loc[0].geometry.coordinates[0],lat:a.loc[0].geometry.coordinates[1],opacity:c.opacity,riseOnHover:!0,station:{id:a._id,name:a.name,exposure:a.exposure,grouptag:a.grouptag,sensors:a.sensors},zIndexOffset:c.zIndexOffset};return d},n=function(a){var b=i.hidden,c={layer:b.layer,icon:b.marker,lng:a.lng,lat:a.lat,opacity:b.opacity,riseOnHover:!0,station:{id:a.station.id,name:a.station.name,exposure:a.station.exposure,grouptag:a.station.grouptag,sensors:a.station.sensors},zIndexOffset:b.zIndexOffset};return c},o=function(b){for(var c in a.markers){var d=a.markers[c];if(d.station.id===b.station.id)return d.layer=b.layer,d.icon=b.icon,void(d.opacity=b.opacity)}};a.fetchMarkers=function(b,d,e){e=e||!1,a.loading=!0,""!==b&&Array.isArray(b)&&(b=b.join(",")),a.markersFiltered={},e?a.filtered={}:a.markers={},c.query({date:b,phenomenon:d},function(b){if(g.boxes=[],a.markersFiltered={},e){var c=[];angular.extend(c,a.markers);var c=c.map(n);angular.extend(a.markers,c);var d=b.map(m);d.map(o),a.markersFiltered=angular.copy(a.markers)}else angular.extend(a.markers,b.map(m)),a.markersFiltered=angular.copy(a.markers);a.loading=!1;for(var f in a.markers){var h=a.markers[f];g.boxes.push(h)}})},a.fetchMarkers("",""),a.hoverlabel={left:0,top:0,name:""},a.$on("leafletDirectiveMarker.map_main.mouseover",function(b,c){var d=c.leafletEvent.target._icon.getBoundingClientRect();a.hoverlabel={left:d.left,top:d.top,name:c.leafletEvent.target.options.station.name}}),a.$on("leafletDirectiveMarker.map_main.mouseout",function(){a.hoverlabel={left:0,top:0,name:""}}),a.$on("leafletDirectiveMarker.map_main.click",function(c,d){a.centerLatLng(d.leafletEvent.target._latlng),b.go("explore.map.boxdetails",{id:d.leafletEvent.target.options.station.id})}),d.getMap("map_main").then(function(b){var c=L.control({position:"bottomleft"});c.onAdd=function(){var b=L.DomUtil.create("div","info sensebox-legend");return this._div=b,e("views/explore2.map.legend.html").then(function(d){var e=angular.element(d),g=angular.element(b),h=angular.element(c._container);g.append(e),h.append(e),f(e)(a)}),this._div},b.addControl(c)}),a.centerLatLng=function(a){d.getMap("map_main").then(function(b){var c=450;document.body.clientWidth<=700&&(c=0),b.fitBounds([a,a],{paddingTopLeft:[0,0],paddingBottomRight:[c,0],maxZoom:17,animate:!1})})}}]),angular.module("openSenseMapApp").controller("SidebarCtrl",["$scope",function(a){a.a="a"}]),angular.module("openSenseMapApp").controller("SidebarBoxDetailsCtrl",["$scope","$stateParams","$http","OpenSenseBox","OpenSenseBoxesSensors","OpenSenseBoxAPI","Validation","ngDialog","$timeout","OpenSenseBoxData",function(a,b,c,d,e,f,g,h,i,j){a.osemapi=f,a["true"]=!0,a.prom,a.delay=6e4;var k=function(){a.prom=i(k,a.delay),e.query({boxId:b.id},function(b){void 0===a.selectedMarkerData?a.selectedMarkerData=b:a.selectedMarkerData.sensors.map(function(a){for(var c=0;c<b.sensors.length;c++)a._id===b.sensors[c]._id&&void 0!==a.lastMeasurement&&angular.extend(a.lastMeasurement,b.sensors[c].lastMeasurement)})})};d.query({boxId:b.id},function(b){var c=[b.loc[0].geometry.coordinates[1],b.loc[0].geometry.coordinates[0]];a.$parent.centerLatLng(c),a.selectedMarker=b,k()},function(){a.boxNotFound=!0}),a.closeSidebar=function(){i.cancel(a.prom)},a.openEditDialog=function(){a.launchTemp=h.open({template:"/views/editbox.html",className:"ngdialog-theme-default",scope:a,showClose:!0,closeByDocument:!1,controller:"EditboxCtrl"})},a.getBadgeColor=function(a){return"indoor"===a?"orange":"olive"},a.getIcon=function(a){return void 0!==a.icon?a.icon:"HDC1008"!==a.sensorType&&"DHT11"!==a.sensorType||"Temperatur"!==a.title?"HDC1008"===a.sensorType||"rel. Luftfeuchte"===a.title||"Luftfeuchtigkeit"===a.title?"osem-humidity":"LM386"===a.sensorType?"osem-volume-up":"BMP280"===a.sensorType&&"Luftdruck"===a.title?"osem-barometer":"TSL45315"===a.sensorType||"VEML6070"===a.sensorType?"osem-brightness":"osem-dashboard":"osem-thermometer"},a.columns=[],a.sensordata={},a.chartDone={},a.chartError={},a.getData=function(b,c){if(c){var d="",e=a.selectedMarker._id;a.chartDone[b]=!1,a.chartError[b]=!1;for(var f=0;f<a.selectedMarkerData.sensors.length;f++)if(b===a.selectedMarkerData.sensors[f]._id){var g=a.selectedMarkerData.sensors[f].title.toString().replace(".","");if(a.columns[b]=[{id:g,type:"scatter"},{id:"dates",type:"date"}],a.sensordata[b]=[],!a.selectedMarkerData.sensors[f].lastMeasurement)continue;d=a.selectedMarkerData.sensors[f].lastMeasurement.createdAt,j.query({boxId:e,sensorId:b,date1:"",date2:d}).$promise.then(function(c){for(var d=0;d<c.length;d++){var e=new Date(c[d].createdAt),f={};f[g]=parseFloat(c[d].value),f.dates=e,a.sensordata[b].push(f)}a.chartDone[b]=!0},function(){a.chartError[b]=!0,a.chartDone[b]=!0})}}},a.formatDate=function(a){return d3.time.format("%Y-%m-%d")(new Date(a))},a.formatDateFull=function(a){return d3.time.format("%Y-%m-%d %H:%M:%S")(new Date(a))}}]),angular.module("openSenseMapApp").controller("SidebarFilterCtrl",["$scope","$stateParams","$http","OpenSenseBox","OpenSenseBoxesSensors","OpenSenseBoxAPI","Validation","filterFilter","$timeout","$filter","phenomenonsFilter","boxFilter","FilterActiveService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.filterActive=m,a.inputFilter=a.inputFilter||{},a.inputFilter.DateTo&&""!==a.inputFilter.DateTo&&a.inputFilter.DateFrom&&""!==a.inputFilter.DateFrom&&(a.needsRefresh=!0),a.filterByDate=function(b){return b.station.sensors.some(function(b,c,d){return b.lastMeasurement&&b.lastMeasurement.updatedAt&&Date.parse(b.lastMeasurement.updatedAt)>a.inputFilter.Date})},a.endingDate=function(b){a.inputFilter.DateTo=new Date,a.inputFilter.DateFrom=new Date((new Date).valueOf()-864e5*b),a.needsRefresh=!0},a.performFilter=function(){a.filterActive.active=!0;var b={station:{name:a.inputFilter.Name,grouptag:a.inputFilter.Grouptag,exposure:a.inputFilter.Exposure}};a.needsRefresh&&a.inputFilter.DateTo&&""!==a.inputFilter.DateTo&&a.inputFilter.DateFrom&&""!==a.inputFilter.DateFrom&&a.$parent.fetchMarkers([a.inputFilter.DateFrom.toISOString(),a.inputFilter.DateTo.toISOString()],a.inputFilter.Phenomenon,!0),""===a.inputFilter.Name&&""===a.inputFilter.Grouptag&&""===a.inputFilter.Exposure||(a.$parent.markersFiltered=l(a.$parent.markers,b)),""!==a.inputFilter.Phenomenon&&(a.$parent.markersFiltered=k(a.$parent.markersFiltered,a.inputFilter.Phenomenon)),a.needsRefresh=!1};var n;a.liveSearch=function(){n&&i.cancel(n),n=i(function(){a.performFilter(),n=null},500)},a.resetFilter=function(){a.inputFilter.Name="",a.inputFilter.Grouptag="",a.inputFilter.DateFrom="",a.inputFilter.DateTo="",a.inputFilter.Exposure="",a.inputFilter.Phenomenon="",a.filterActive.active=!1},a.refreshData=function(){a.$parent.fetchMarkers("","")},a.openDatepicker=function(b){b.preventDefault(),b.stopPropagation(),"datepicker1"===b.currentTarget.id?(a.opened1=!0,a.opened2=!1):"datepicker2"===b.currentTarget.id&&(a.opened2=!0,a.opened1=!1)},a.checkPhenomNeedsRefresh=function(){a.inputFilter.DateFrom&&""!==a.inputFilter.DateFrom||a.inputFilter.DateTo&&""!==a.inputFilter.DateTo?a.needsRefresh=!0:a.performFilter()}}]),angular.module("openSenseMapApp").controller("InterpolationCtrl",["$scope","$stateParams","$http","OpenSenseBoxAPI","leafletData","$timeout","moment",function(a,b,c,d,e,f,g){a.calculating=!1,a.interpolationPicker={date:g().toDate(),open:!1,buttonBar:{show:!1},timepickerOptions:{readonlyInput:!1,showMeridian:!1,max:g().toDate()}},a.legendTitle="",a.legendEntries=[],a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.exposure="outdoor",a.idwLayer,a.selectedPhenomenon="",a.map,a.calculateInterpolation=function(){a.calculating=!0,a.alerts.length=0,a.legendEntries.length=0,a.legendTitle="",e.getMap("map_main").then(function(b){return angular.isUndefined(a.idwLayer)||b.removeLayer(a.idwLayer),a.map=b,b.getBounds().toBBoxString()}).then(function(b){c.get(d.url+"/statistics/idw",{params:{phenomenon:a.selectedPhenomenon,"from-date":g(a.interpolationPicker.date).subtract(1,"m").toISOString(),"to-date":g(a.interpolationPicker.date).toISOString(),exposure:a.exposure,cellWidth:1,power:3,numClasses:6,bbox:b,numTimeSteps:1}}).then(function(b){var c="#A2F689,#B1E36F,#BCD05B,#C4BD4C,#C8AA44,#C99840".split(","),d=b.data.data.breaks;switch(a.selectedPhenomenon){case"Temperatur":a.legendTitle=a.selectedPhenomenon+" in °C";break;case"rel. Luftfeuchte":a.legendTitle=a.selectedPhenomenon+" in %";break;case"Luftdruck":a.legendTitle=a.selectedPhenomenon+" in hPa";break;case"Beleuchtungsstärke":a.legendTitle=a.selectedPhenomenon+" in lx";break;case"UV-Intensität":a.legendTitle=a.selectedPhenomenon+" in μW/cm²"}for(var e=0;e<d.length;e++){var f="";f=e===d.length-1?"> "+d[e].toFixed(2):d[e].toFixed(2)+" - "+d[e+1].toFixed(2),a.legendEntries.push({caption:f,style:{background:c[e]}})}a.idwLayer=L.geoJson(b.data.data.featureCollection,{style:function(a){var b=a.properties;for(var e in b){var f=b[e];if(!Number.isNaN(f)){for(var g=c[0],h=0;h<d.length&&f>=d[h];h++)g=c[h];return{weight:.1,fillOpacity:.6,fillColor:g}}return{weight:0,fillColor:"red",fillOpacity:1}}}}),a.map.addLayer(a.idwLayer)},function(b){
switch(b.data.message){case"computation too expensive ((area in square kilometers / cellWidth) > 2500)":a.alerts.push({msg:"Der gewählte Kartenausschnitt ist zu groß!"});break;case"Invalid time frame specified: to-date is in the future":a.alerts.push({msg:"Das gewählte Datum darf nicht in der Zukunft liegen!"});break;case"no senseBoxes found":a.alerts.push({msg:"Es konnten keine senseBoxen für die Filtereinstellungen gefunden werden!"})}})["finally"](function(){a.calculating=!1})})},a.openCalendar=function(b,c){b.preventDefault(),b.stopPropagation(),a.interpolationPicker.open=!0,a.interpolationPicker.timepickerOptions.max=g().toDate()},a.selectExposure=function(b){a.exposure=b},a.closeSidebar=function(){angular.isUndefined(a.map)||angular.isUndefined(a.idwLayer)||a.map.removeLayer(a.idwLayer)}}]),function(){"use strict";function a(a,b){console.log("hallo");var c=this;c.credentials={username:"",password:""},c.onSubmit=function(){b.login(c.credentials).error(function(a){alert(a)}).then(function(){a.path("/loginsuccess"),document.getElementById("navlogin").style.display="none",document.getElementById("profile").style.display="block"})}}angular.module("openSenseMapApp").controller("loginCtrl",a),a.$inject=["$location","authentication"],document.getElementById("profile").style.display="none"}(),function(){"use strict";function a(a,b,c,d,e,f){console.log("tata"),f.localStorage.clear(),document.getElementById("navlogin").style.display="block",document.getElementById("profile").style.display="none"}angular.module("openSenseMapApp").controller("logoutCtrl",a),a.$inject=["$location","$translate","authentication","meanData","userService","$window"]}(),function(){"use strict";function a(a,b){var c=this;c.user={},b.getProfile().success(function(a){c.user=a}).error(function(a){alert(a)})}angular.module("openSenseMapApp").controller("loginsuccessCtrl",a),a.$inject=["$location","meanData"]}(),angular.module("openSenseMapApp").controller("SidebarDownloadCtrl",["$scope","$stateParams","$http","OpenSenseBox","OpenSenseBoxAPI","leafletData",function(a,b,c,d,e,f){function g(){try{return"-"+(new Date).toISOString().replace(/-|:|\.\d*Z/g,"").replace("T","_")}catch(a){return""}}a.markersFiltered=a.$parent.markersFiltered,a.$watch("$parent.loading",function(){a.markersFiltered=a.$parent.markersFiltered}),a.osemapi=e,a.inputFilter=a.inputFilter||{},a.downloadform={format:"CSV",pleaseWait:!1,emptyData:!1,errorOccured:!1},a.openDatepicker=function(b){b.preventDefault(),b.stopPropagation(),"datepicker1"===b.currentTarget.id?(a.opened1=!0,a.opened2=!1):"datepicker2"===b.currentTarget.id&&(a.opened2=!0,a.opened1=!1)},a.endingDate=function(b){a.inputFilter.DateTo=new Date,a.inputFilter.DateFrom=new Date((new Date).valueOf()-864e5*b)},f.getMap("map_main").then(function(b){a.count=a.countBbox(b).length,b.on("zoomend moveend",function(c){a.count=a.countBbox(b).length})}),a.countBbox=function(b){var c=[],d=b.getBounds();return angular.forEach(a.markersFiltered,function(a,b){d.contains([a.lat,a.lng])&&c.push(a.station.id)}),c},a.dataDownload=function(){a.downloadform.pleaseWait=!0,f.getMap("map_main").then(function(b){var d=a.countBbox(b);c.get(a.osemapi.url+"/boxes/data",{params:{boxid:d.join(","),"to-date":a.inputFilter.DateTo,"from-date":a.inputFilter.DateFrom,phenomenon:a.inputFilter.Phenomenon}}).success(function(b){if(console.log(b.length),b.length>0){var c=new Blob([b],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");d.href=window.URL.createObjectURL(c),d.download="opensensemap_org-download-"+encodeURI(a.inputFilter.Phenomenon)+g()+".csv",d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}else a.downloadform.emptyData=!0;a.downloadform.pleaseWait=!1}).error(function(b,c){a.downloadform.pleaseWait=!1,0===b.length&&404===c?a.downloadform.emptyData=!0:(a.downloadform.errorOccured=!0,console.log(c))})})}}]),angular.module("openSenseMapApp").controller("EditboxCtrl",["$scope","Validation","$http","OpenSenseBoxAPI","SensorIcons",function(a,b,c,d,e){a.osemapi=d,a.icons=e,a.editingMarker=angular.copy(a.$parent.selectedMarker),a.mqtt={enabled:!1,url:"",topic:"",messageFormat:"",decodeOptions:"",connectionOptions:""},a.sensorsEditMode=!1,a.boxPosition={lng:parseFloat(a.editingMarker.loc[0].geometry.coordinates[0].toFixed(6)),lat:parseFloat(a.editingMarker.loc[0].geometry.coordinates[1].toFixed(6)),zoom:17},a.editMarkerInput=angular.copy(a.boxPosition),a.resetPosition=function(){a.editMarker={m1:angular.copy(a.boxPosition)},a.editMarkerInput=angular.copy(a.boxPosition),a.editMarker.m1.draggable=!0,delete a.editMarker.m1.zoom},a.resetPosition(),a.$watchCollection("editMarkerInput",function(b){b&&b.lat&&b.lng&&(a.editMarker.m1.lng=b.lng,a.editMarker.m1.lat=b.lat)}),a.$on("leafletDirectiveMap.editbox_map.click",function(b,c){a.editMarker.m1.lng=parseFloat(c.leafletEvent.latlng.lng.toFixed(6)),a.editMarker.m1.lat=parseFloat(c.leafletEvent.latlng.lat.toFixed(6)),a.editMarkerInput.lng=a.editMarker.m1.lng,a.editMarkerInput.lat=a.editMarker.m1.lat}),a.$on("leafletDirectiveMarker.editbox_map.dragend",function(b,c){a.editMarker.m1.lng=parseFloat(c.model.lng.toFixed(6)),a.editMarker.m1.lat=parseFloat(c.model.lat.toFixed(6)),a.editMarkerInput.lng=a.editMarker.m1.lng,a.editMarkerInput.lat=a.editMarker.m1.lat}),a.editMapDefaults=angular.copy(a.defaults),a.editMapDefaults.scrollWheelZoom=!1,a.apikey={},a.enableEditableMode=function(){var c=a.editingMarker._id;b.checkApiKey(c,a.apikey.key).then(function(b){a.apikeyIssue=!1,200===b.status?(a.editableMode=!0,a.apikeyIssue=!1,a.mqtt=b.data.mqtt):(a.apikeyIssue=!0,a.editableMode=!1)})},a.setSensorIcon=function(a,b){a.icon=b.name},a.cancelChange=function(){a.editableMode=!1,delete a.editingMarker,a.closeThisDialog()},a.saveChange=function(){a.savedSuccessfully=!1,a.savedError=!1;var b=a.editingMarker._id,d=angular.element(document.getElementById("flowUploadImage")).attr("src"),e={_id:a.editingMarker._id,name:a.editingMarker.name,sensors:a.editingMarker.sensors,description:a.editingMarker.description,weblink:a.editingMarker.weblink,grouptag:a.editingMarker.grouptag,exposure:a.editingMarker.exposure,loc:a.editMarker.m1,image:d,mqtt:a.mqtt};c.put(a.osemapi.url+"/boxes/"+b,e,{headers:{"X-ApiKey":a.apikey.key}}).success(function(b){a.savedSuccessfully=!0,a.savedError=!1,""===b.image?a.image="placeholder.png":a.image=b.image,a.editingMarker=angular.copy(b),a.$parent.selectedMarker=angular.copy(b)}).error(function(){a.savedError=!0})},a.flowFileAdded=function(a){return("jpg"===a.getExtension().toLowerCase()||"png"===a.getExtension().toLowerCase()||"jpeg"===a.getExtension().toLowerCase())&&a.size<512e3};var f=function(){for(var b=a.editingMarker.sensors.length-1;b>=0;b--)if(a.editingMarker.sensors[b].editing)return void(a.sensorsEditMode=!0);a.sensorsEditMode=!1};a.addSensor=function(){a.editingMarker.sensors.push({icon:"",sensorType:"",title:"",unit:"",editing:!0,"new":!0}),f()},a.editSensor=function(a){a.restore=angular.copy(a),a.editing=!0,f()},a.saveSensor=function(a){return""===a.icon||""===a.name||""===a.sensorType||""===a.unit?(a.incomplete=!0,!1):(a.editing=!1,a.incomplete=!1,a.edited=!0,void f())},a.deleteSensor=function(b){if(b["new"]){var c=a.editingMarker.sensors.indexOf(b);c!==-1&&a.editingMarker.sensors.splice(c,1)}else b.deleted=!0,b.incomplete=!1},a.cancelSensor=function(b){if(b["new"]){var c=a.editingMarker.sensors.indexOf(b);c!==-1&&a.editingMarker.sensors.splice(c,1)}else{b.incomplete=!1,b.editing=!1;for(var d in b.restore){var e=b.restore[d];b[d]=e}}f()},a.downloadArduino=function(){var b=a.editingMarker._id;c.get(a.osemapi.url+"/boxes/"+b+"/script",{headers:{"X-ApiKey":a.apikey.key}}).success(function(b){a.boxScript=b}).error(function(){})},a.deleteBox=function(){var b=a.editingMarker._id;c["delete"](a.osemapi.url+"/boxes/"+b,{headers:{"X-ApiKey":a.apikey.key}}).success(function(){a.boxdeleted=!0,a.editableMode=!1}).error(function(){a.errorDuringDelete=!0})},a.getIcon=function(a){return void 0!==a.icon?a.icon:"HDC1008"!==a.sensorType&&"DHT11"!==a.sensorType||"Temperatur"!==a.title?"HDC1008"===a.sensorType||"rel. Luftfeuchte"===a.title||"Luftfeuchtigkeit"===a.title?"osem-humidity":"LM386"===a.sensorType?"osem-volume-up":"BMP280"===a.sensorType&&"Luftdruck"===a.title?"osem-barometer":"TSL45315"===a.sensorType||"VEML6070"===a.sensorType?"osem-brightness":"osem-dashboard":"osem-thermometer"}}]),angular.module("openSenseMapApp").controller("HeaderCtrl",["$scope","$rootScope","$translate","$http","authentication","OpenSenseBoxAPI","meanData","FilterActiveService","amMoment","tmhDynamicLocale","OpenSenseMapData","$state","leafletData",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.osemapi=g,a.isLoggedIn=e.isLoggedIn(),0==a.isLoggedIn?(console.log("Ausgeloggt"),document.getElementById("profile").style.display="none",document.getElementById("navlogin").style.display="block"):(console.log("Eingeloggt"),document.getElementById("profile").style.display="block",document.getElementById("navlogin").style.display="none"),a.changeLang=function(b){c.use(b).then(function(b){console.log("Sprache zu "+b+" gewechselt."),a.key=b.split("_")[0],i.changeLocale(a.key),j.set(a.key)},function(a){console.log("Fehler beim wechseln zur Sprache "+a)})},a.changeLang("de_DE"),a.counts={boxes:"",measurements:""},d.get(a.osemapi.url+"/stats").success(function(b){a.counts.boxes=b[0],a.counts.measurements=b[1]}).error(function(){}),a.filterActive=h,a.getBoxes=function(a){var b=k.boxes;return b},a.centerLatLng=function(a){m.getMap("map_main").then(function(b){b.fitBounds([[a[0],a[2]],[a[1],a[3]]],{paddingTopLeft:[0,0],animate:!1,zoom:20})})},a.modelOptions={debounce:{"default":300,blur:250},getterSetter:!0},a.getLocations=function(a){return d.get("//locationiq.org/v1/search.php",{params:{format:"json",key:"23e12b10d8c3aad04e8e",addressdetails:1,limit:4,q:a}}).then(function(b){var c=b.data.map(function(a){return a}),d=0;return k.boxes.filter(function(b){if(4!==d&&b.station.name.match(new RegExp(a,"i"))){d++;var e={display_name:b.station.name,boxId:b.station.id};c.unshift(e)}}),c})},a.selectBox=function(a){void 0===a.boundingbox?l.go("explore.map.boxdetails",{id:a.boxId}):this.centerLatLng(a.boundingbox)}}]),function(){"use strict";function a(a,b,c,d){function e(){if(0==document.getElementById("password").value.length||0==document.getElementById("password2").value.length)alert("Zum ändern MUSST Du dein Passwort eintragen");else if(h.user.password!==h.user.password2)alert("Passwörter stimmen nicht überein!");else{var b=h.user.birthday,d=b.split("."),e=new Date(parseInt(d[2],10),parseInt(d[1]-1,10),parseInt(d[0],10));h.user.birthday=e,c.update(h.user).then(function(){a.path("/account")})["catch"](function(a){console.log(a)})}}function f(){var b=confirm("Hallo!\nWollen sie Ihren Account wirklich löschen?");b!==!0&&(location.href="/"),c.deleteUsers(h.user).then(function(){a.path("/login"),document.getElementById("navlogin").style.display="block",document.getElementById("profile").style.display="none"})["catch"](function(a){console.log(a)})}function g(){var b=angular.element(document.getElementById("flowUploadImage")).attr("src");console.log(b);var d={image:b};c.savingImage(d).then(function(){a.path("/account")})["catch"](function(a){console.log(a)})}var h=this;h.user={},h.saveUser=e,h.deleteUser=f,h.saveImage=g,b.getProfile().success(function(a){h.user=a,null==h.user.birthday?h.user.birthday="":""!=h.user.birthday&&(h.user.birthday=b.renderDate(h.user.birthday))}).error(function(a){console.log(a)}),d.flowFileAdded=function(a){return("jpg"===a.getExtension().toLowerCase()||"png"===a.getExtension().toLowerCase()||"jpeg"===a.getExtension().toLowerCase())&&a.size<512e3}}angular.module("openSenseMapApp").controller("profileCtrl",a),a.$inject=["$location","meanData","userService","$scope"]}(),function(){function a(a,b,c,d,e,f,g,h){var i=this;i.user={};var j=Date();i.isLoggedIn=b.isLoggedIn(),c.getProfile().success(function(a){i.user=a,i.user.registrDate2=i.user.registrDate,i.user.registrDate=c.renderDate(i.user.registrDate),i.today=c.renderDate(j),""!=i.user.birthday&&(i.birthday2=c.renderDate2(i.user.birthday),i.user.birthday=c.renderDate(i.user.birthday)),i.AnzahlTage=Math.floor((new Date(j)-new Date(i.user.registrDate2))/864e5),i.AnzahlStunden=Math.floor((new Date(j)-new Date(i.user.registrDate2))/36e5),i.AnzahlJahre=new Date(j).getFullYear()-new Date(i.user.registrDate2).getFullYear(),i.user.registrDate2=new Date(c.renderDate2(i.user.registrDate2)),i.user.registrDate2>new Date(j)&&(i.AnzahlJahre=i.AnzahlJahre-1)}).error(function(a){console.log(a)}),e.flowFileAdded=function(a){return("jpg"===a.getExtension().toLowerCase()||"png"===a.getExtension().toLowerCase()||"jpeg"===a.getExtension().toLowerCase())&&a.size<512e3}}angular.module("openSenseMapApp").controller("accountCtrl",a),a.$inject=["$location","authentication","meanData","userService","$scope","$rootScope","$document","$http"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){console.log("Die Entfernung zur Sensebox beträgt: "+(C.distanceTo([t,u])/1e3).toFixed(2)+"Km"),f.distance=(C.distanceTo([t,u])/1e3).toFixed(2),console.log("l33337 Test  "+f.distance),(C.distanceTo([t,u])/1e3).toFixed(2)<50&&(w=Number(100),x+=100),(C.distanceTo([t,u])/1e3).toFixed(2)<150&&(C.distanceTo([t,u])/1e3).toFixed(2)>50&&(w=Number(50),x+=50),(C.distanceTo([t,u])/1e3).toFixed(2)<250&&(C.distanceTo([t,u])/1e3).toFixed(2)>100&&(w=Number(10),x+=10),(C.distanceTo([t,u])/1e3).toFixed(2)>250&&(w=Number(1),x+=1)}function j(a){null==y?(q.addTo(H),y=new L.marker(a.latlng,{draggable:!1}),H.addLayer(y),C=y.getLatLng(),F=[C.lat,C.lng]):(q.addTo(H),H.removeLayer(y),y=null,y=new L.marker(a.latlng,{draggable:!1}),C=y.getLatLng(),F=[C.lat,C.lng],H.addLayer(y))}function k(a,b){var c=a[Math.floor(Math.random()*a.length)];console.log("RandomBoxId: "+c),l(c,b),H.removeLayer(y),H.removeLayer(s),H.removeLayer(z),H.removeLayer(r),H.removeLayer(p)}function l(a,b){b({method:"GET",url:"https://api.opensensemap.org/boxes/"+a}).then(function(a){if(void 0===a.data.sensors||0==a.data.sensors[0].hasOwnProperty("lastMeasurement")||null==a.data.sensors[0].lastMeasurement||a.data.sensors[0].lastMeasurement.createdAt<=D||"indoor"==a.data.exposure||a.data.sensors.length<3)k(E,b);else{n.test=!1,console.log("sucess"),t=a.data.loc[0].geometry.coordinates[1],u=a.data.loc[0].geometry.coordinates[0];for(var c=[],d=0;d<a.data.sensors.length;d++){var e={};e.title=a.data.sensors[d].title,e.value=a.data.sensors[d].lastMeasurement.value,e.unit=a.data.sensors[d].unit;var g=a.data.sensors[d].lastMeasurement.createdAt,h=new Date(g),i=h.getDate(),j=h.getMonth()+1,l=h.getUTCFullYear(),m=h.getUTCHours(),o=h.getUTCMinutes();o<10&&(o="0"+o),m<10&&(m="0"+m);var p=i+"."+j+"."+l+" um: "+m+":"+o+" (UTC)";e.lastMeasurement=p,c.push(e)}f.box=c}},function(a){console.log(a)})}function m(a){c.countPoints(a).success(function(){console.log("gespeichert")})["catch"](function(a){console.log(a)})}var n=this;if(n.isLoggedIn=a.isLoggedIn(),0==n.isLoggedIn){var o=confirm("Hallo!\nDu bist nicht eingeloggt! \nDu kannst zwar spielen, deine erreichten Punkte werden aber NICHT gespeichert!\nWillst Du dennoch spielen?");o!==!0&&(location.href="/")}var n=this;n.users={},n.user={},c.getAllProfiles().success(function(a){n.users=a,console.log(n.users)}).error(function(a){console.log(a)}),c.getProfile().success(function(a){n.user=a}).error(function(a){console.log(a)});var p,q,r,s,t,u,v,w=0,x=0,y=null,z=null,A=(L.popup(),0),B=new Date;B.setHours(B.getHours()-1);var C,D=B.toISOString(),E=[],F=[];f.box=[],f.distance=[];var G=new L.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),H=L.map("mapid").setView([51.4,9],2);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"hoelsch.e2b0812b",accessToken:"pk.eyJ1IjoiaG9lbHNjaCIsImEiOiJxblpwakZrIn0.JTTnLszkIJB11k8YEe7raQ"}).addTo(H),f.map=H,g({method:"GET",url:"https://api.opensensemap.org/boxes?"}).then(function(a){f.myData=a.data;for(var b in a.data)E.push(a.data[b]._id);k(E,g)},function(a){f.myData=a.statusText}),H.on("click",j),f.distance=v,console.log("heiiiide "+v),q=new L.easyButton("glyphicon-ok",function(){if(null==z){z=L.marker([t,u],{icon:G}).addTo(H),q.remove(),r.addTo(H),A++,i();var a=[t,u],b=[a,F];console.log(a,F),p=new L.Polyline(b,{color:"red",weight:3,opacity:.5,smoothFactor:1}),p.addTo(H),m(w),H.fitBounds(p.getBounds());var c=[(a[0]+F[0])/2,(a[1]+F[1])/2];console.log(c),s=L.popup().setLatLng(c).setContent("Du hast jetzt "+A+" Runden gespielt. Du hast "+w+" Punkt(e) in dieser Runde erzielt, <br> deine Gesamtpunktzahl ist "+x).addTo(H)}else{H.removeLayer(z),H.removeLayer(p),z=L.marker([t,u],{icon:G}).addTo(H);var a=[t,u],b=[a,F];console.log(a,F),p=new L.Polyline(b,{color:"red",weight:3,opacity:.5,smoothFactor:1}),p.addTo(H),H.fitBounds(p.getBounds())}}),r=new L.easyButton("fa-repeat",function(){H.setView([51.4,9],2),H.removeLayer(y),H.removeLayer(s),H.removeLayer(z),H.removeLayer(p),r.remove(),q.remove(),z=null,k(E,g)}),H.on("click",j),n.test=!0}angular.module("openSenseMapApp").controller("gameCtrl",a),a.$inject=["authentication","$location","meanData","$translate","userService","$scope","$http","ngDialog"]}(),function(){"use strict";function a(a,b,c){var d=this;d.users={},d.user={},b.getAllProfiles().success(function(a){d.users=a,console.log(d.users)}).error(function(a){console.log(a)}),b.getProfile().success(function(a){d.user=a}).error(function(a){console.log(a)})}angular.module("openSenseMapApp").controller("leaderboardCtrl",a),a.$inject=["$location","meanData","userService"]}(),angular.module("openSenseMapApp").factory("OpenSenseBoxAPI",function(){var a={url:"localhost:8000"};return a}),angular.module("openSenseMapApp").factory("OpenSenseBoxes",["$resource","OpenSenseBoxAPI",function(a,b){return a(b.url+"/boxes",{date:"@date",phenomenon:"@phenomenon"},{query:{method:"get",isArray:!0}})}]),angular.module("openSenseMapApp").factory("OpenSenseBoxesSensors",["$resource","OpenSenseBoxAPI",function(a,b){return a(b.url+"/boxes/:boxId/sensors",{},{query:{method:"GET",isArray:!1}})}]),angular.module("openSenseMapApp").factory("OpenSenseBoxData",["$resource","OpenSenseBoxAPI",function(a,b){return a(b.url+"/boxes/:boxId/data/:sensorId?from-date=:date1&to-date=:date2",{},{query:{method:"GET",isArray:!0}})}]),angular.module("openSenseMapApp").service("OpenSenseMapData",function(){var a=this;a.boxes=[]});var trash={layer:"hiddenMarker",icon:{},lng:2e3,lat:2e3,opacity:0,riseOnHover:!1,station:{id:"",name:"",exposure:"",grouptag:"",sensors:[]}};angular.module("osemFilters",[]).filter("phenomenons",function(){"use strict";return function(a,b){var c=b||"",d=[];return angular.forEach(a,function(a){var b=a.station.sensors.some(function(a){return a.hasOwnProperty("title")&&a.title.toLowerCase().indexOf(c.toLowerCase())!==-1});b?d.push(a):d.push(angular.copy(trash))}),d}}).filter("marker",function(){"use strict";return function(a,b){var c=b||"";angular.forEach(a,function(a){var b=a.station.name.toLowerCase().indexOf(c.toLowerCase())!==-1;return b&&a})}}).filter("uniquePhenomenons",function(){"use strict";return function(a){var b=[];return angular.forEach(a,function(a){angular.forEach(a.station.sensors,function(a){b.indexOf(a.title)===-1&&b.push(a.title)})}),b}}).filter("uniqueGrouptags",function(){"use strict";return function(a){var b=[];return angular.forEach(a,function(a){b.indexOf(a.station.grouptag)===-1&&b.push(a.station.grouptag)}),b}}).filter("box",["filterFilter",function(a){"use strict";return function(b,c){var d=[];return angular.forEach(b,function(b){var e=a([b],c);e.length>0?d.push(b):d.push(angular.copy(trash))}),d}}]),angular.module("openSenseMapApp").factory("Validation",["$http","$q","OpenSenseBoxAPI",function(a,b,c){var d={},e=function(b,d){return a({method:"GET",url:c.url+"/users/"+b,headers:{"X-ApiKey":d},params:{returnBox:!0}})};return d.checkApiKey=function(a,c){var d=e(a,c),f=b.defer();return d.success(function(a,b){f.resolve({data:a,status:b})}).error(function(a,b){f.resolve({data:a,status:b})}),f.promise},d}]),angular.module("openSenseMapApp").factory("OpenSenseBox",["$resource","OpenSenseBoxAPI",function(a,b){return a(b.url+"/boxes/:boxId",{},{query:{method:"GET",isArray:!1}})}]),angular.module("openSenseMapApp").factory("SensorIcons",function(){var a=[{name:"osem-moisture"},{name:"osem-temperature-celsius"},{name:"osem-temperature-fahrenheit"},{name:"osem-thermometer"},{name:"osem-windspeed"},{name:"osem-sprinkles"},{name:"osem-brightness"},{name:"osem-barometer"},{name:"osem-humidity"},{name:"osem-not-available"},{name:"osem-gauge"},{name:"osem-umberella"},{name:"osem-clock"},{name:"osem-shock"},{name:"osem-fire"},{name:"osem-volume-up"},{name:"osem-cloud"},{name:"osem-dashboard"}];return a}),function(){function a(a,b){var c=function(a){b.localStorage["mean-token"]=a},d=function(a){b.localStorage.removeItem(a)},e=function(){return b.localStorage["mean-token"]},f=function(){var a,c=e();return!!c&&(a=c.split(".")[1],a=b.atob(a),a=JSON.parse(a),a.exp>Date.now()/1e3)},g=function(){if(f()){var a=e(),c=a.split(".")[1];return c=b.atob(c),c=JSON.parse(c),{firstname:c.firstname,lastname:c.lastname,email:c.email,username:c.username}}};return register=function(b){return console.log("hallo"),a.post("/api/register",b).success(function(a){c(a.token)})},login=function(b){return a.post("/api/login",b).success(function(a){c(a.token)})},logout=function(b){return a.get("/api/logout",b).success(function(a){d(a.token)})},{currentUser:g,saveToken:c,getToken:e,isLoggedIn:f,register:register,login:login,logout:logout}}angular.module("openSenseMapApp").service("authentication",a),a.$inject=["$http","$window"]}(),function(){function a(a,b){function c(a){var b=new Date(a),c=b.getDate(),d=b.getMonth()+1,e=b.getUTCFullYear();c<10&&(c="0"+c),d<10&&(d="0"+d);var f=c+"."+d+"."+e;return f}function d(a){var b=new Date,c=new Date(a),d=c.getDate(),e=c.getMonth()+1,f=b.getUTCFullYear();d<10&&(d="0"+d),e<10&&(e="0"+e);var g=d+"."+e+"."+f;return g}var e=function(){return a.get("/api/profile",{headers:{Authorization:"Bearer "+b.getToken()}})},f=function(){return a.get("/api/allProfiles")};return countPoints=function(c){return a.get("/api/game/"+c,{headers:{Authorization:"Bearer "+b.getToken()}})},{getProfile:e,countPoints:countPoints,getAllProfiles:f,renderDate:c,renderDate2:d}}angular.module("openSenseMapApp").service("meanData",a),a.$inject=["$http","authentication"]}(),function(){function a(a,b){function c(c){return a.post("/api/users/"+c._id,c,{headers:{Authorization:"Bearer "+b.getToken()}})}function d(c){return a.post("/api/users/delete/"+c._id,c,{headers:{Authorization:"Bearer "+b.getToken()}})}function e(c){return a.put("api/users/image",c,{headers:{Authorization:"Bearer "+b.getToken()}})}return{update:c,deleteUsers:d,savingImage:e}}angular.module("openSenseMapApp").service("userService",a),a.$inject=["$http","authentication"]}();